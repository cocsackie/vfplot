language: c
compiler:
  - gcc
  - clang
env:
  - CONFIG_OPT="--disable-pthread"
  - CONFIG_OPT="--enable-pthread"
before_install:
  - sudo apt-get update -qq
  - >
    sudo apt-get install -qq
    gengetopt
    docbook-xsl
    xsltproc
    bc
    lynx
    ghostscript
    gmt
    libnetcdf-dev
    libgfs-dev
    libgts-dev
    libcunit1-dev
    python3
  - sudo -H pip install cpp-coveralls
  - autoconf
  - autoheader
install:
  - ./configure --enable-tests --enable-coverage $CONFIG_OPT
  - make
script :
  - make --quiet test
after_success:
  - >
    coveralls --gcov-options '\-lp'
    --exclude src/include
    --exclude src/unit
    --exclude src/libkdtree
    --exclude src/libvfplot/gstack.c
    --exclude src/vfplot/options.c
    --exclude src/gfs2xyz/options.c

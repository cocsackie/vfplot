# Makefile.in for vfplot

# $Id: Makefile.in,v 1.27 2012/05/23 17:52:55 jjg Exp jjg $
# help older versions of make

@SET_MAKE@

# Macros

VERSION   = @VERSION@
RUBBISH   = *~ 
CONFFILES = config.cache config.log config.status configure Makefile

# targets

default : all

all : 
	cd src ; $(MAKE) all ; cd ..

install : 
	cd src ; $(MAKE) install ; cd ..

test check :
	cd src ; $(MAKE) test ; cd ..

profile :
	cd src ; $(MAKE) profile ; cd ..

archive :
	cd src ; $(MAKE) archive ; cd ..

txt : CREDITS.txt CHANGES.txt INSTALL.txt

man : vfplot.1 sag2grd.1 gfs2xyz2D.1 dom.5 sag.5 vgs.5 vfplot-povray.5 
	mv vfplot.1 src/vfplot/vfplot.1
	mv sag2grd.1 src/sag2grd/sag2grd.1
	mv gfs2xyz2D.1 src/gfs2xyz/gfs2xyz2D.1
	mv dom.5 src/libvfplot/dom.5
	mv sag.5 src/libvfplot/sag.5
	mv vgs.5 src/libvfplot/vgs.5
	mv vfplot-povray.5 src/libvfplot/vfplot-povray.5

clean :
	cd src ; $(MAKE) clean ; cd ..
	$(RM) $(RUBBISH)

spotless veryclean :
	cd src ; $(MAKE) veryclean ; cd ..
	$(RM) $(CONFFILES) $(RUBBISH)
	autoconf
	rm -rf autom4te.cache/

dist : man txt veryclean 
	cd .. ; \
	cp -r vfplot vfplot-$(VERSION) ;\
	cd vfplot-$(VERSION) ;\
	$(MAKE) spotless ;\
	cd .. ; \
	tar --exclude=RCS -zcvf snapshot/vfplot-$(VERSION).tar.gz \
	  vfplot-$(VERSION) ;\
	mv vfplot-$(VERSION) /tmp 

maint-dist : clean
	cd .. ; \
	tar -zcvf vfplot-maint.tar.gz vfplot ; \
	cd vfplot

# package documentation

XSLBASE  = /usr/share/xml/docbook/stylesheet
MANXSL   = $(XSLBASE)/nwalsh/manpages/docbook.xsl
XHTMLXSL = $(XSLBASE)/docbook-xsl/xhtml/docbook.xsl

vpath %.xml xml

.SUFFIXES : .1 .5 .txt .xml

.xml.txt :
	xsltproc --xinclude $(XHTMLXSL) $< | lynx -stdin -dump -nolist > $@

.xml.1 :
	xsltproc --xinclude $(MANXSL) $<

.xml.5 :
	xsltproc --xinclude $(MANXSL) $<

